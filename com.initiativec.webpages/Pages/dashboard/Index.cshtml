@page

@using Microsoft.AspNetCore.Builder
@using Microsoft.AspNetCore.Http.Features
@using Microsoft.AspNetCore.Localization
@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.Extensions.Options
@using System.Text.RegularExpressions

@inject IStringLocalizer<IndexModel> localizer
@inject IHtmlLocalizer<IndexModel> htmlLocalizer
@inject IOptions<RequestLocalizationOptions> LocOptions


@model IndexModel
@{
}


<link href="~/js/jssocials/jssocials.css" rel="stylesheet" />
<link href="~/js/jssocials/jssocials-theme-flat.css" rel="stylesheet" />
<script src="~/js/jssocials/jssocials.min.js"></script>
<link href="~/css/font-awesome/font-awesome.min64b2.css" rel="stylesheet" />
<article class="Dashboard">
    
    <section class="column article-section">
        <div class="Dashboard-hero">
            <h1>@string.Format(@localizer["Olá, {0}, bem-vindo a (em breve) maior memecoin da Cardano!"], Model.dashboard.nome_usuario)</h1>
            <p>
                @localizer["Pelos próximos {0} dias voce pode convidar e verificar até {1} pessoas e garantir $LEMON {2} por cada. Com o seu convite, eles também poderão reservar $LEMON com antecedência e ajudar a expandir nossa comunidade",
                         Model.dashboard.qtd_dias_restantes,
                         Model.dashboard.qtd_convites_restantes,
                         Model.dashboard.amount_token_por_convite.ToString("N0")]
            </p>
            <h2 class="small"></h2>
        </div>
        

        <div class="Dashboard-content">
            
            <div class="Dashboard-column">

                @if (Model.enviarConvite != null)
                {
                    if (Model.enviarConvite.status)
                    {
                        <div class="Dashboard-card card">
                            <div class="img-card"><b>!</b></div>
                            <h4 class="title-card">@localizer["Tarefa Atual"]</h4>
                            <p class="subtitle-card">@Html.Raw(string.Format(htmlLocalizer["Convide pessoas que você conhece pessoalmente e garanta um adicional de <b>$LEMON {0}</b>"].Value, Model.enviarConvite.valorConviteTotal.ToString("N0")))</p>
                            <div class="oneFieldForm small">
                                <input type="text" readonly="" class="small" style="font-size: 1.8em;" value="@($"https://lehmonbros.fun/invite/{Model.enviarConvite.invite_code}")">
                                <div class="Button With-icon Button-primary" onclick="CopyToClipboard('massage-copy')" style="text-align: center; background-color:#292874;">@localizer["COPIAR LINK"]</div>
                            </div>

                            <div class="share">

                                <p class="column" style="float: left; font-size: 17px; margin-top: 5px; margin-right: 10px;">@localizer["Ou compartilhar com:"]</p>
                                <div id="btnsSocials" class="jssocials ">
                                    <div class="jssocials-shares column right-side">
                                        <div class="jssocials-share jssocials-share-email">
                                            <a target="_self" href="mailto:?subject=%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20A%20Initial%20S%20%C3%A9%20um%20ousado%20projeto%20que%20tenta%20criar%20uma%20nova%20forma%20de%20se%20investir%20e%20de%20conseguir%20investimentos%20para%20Startups.%20Utilizando%20uma%20moeda%20propriet%C3%A1ria%2C%20a%20Start%2C%20eles%20buscam%20incentivar%20as%20pessoas%20a%20come%C3%A7arem%20a%20usar%20a%20plataforma%20uma%20vez%20que%20ela%20estiver%20pronta.%20Eles%20est%C3%A3o%20reservando%20Starts%20gratuitamente%20para%20pessoas%20que%20se%20cadastrarem%20agora%20(o%20valor%20diminui%20%C3%A0%20medida%20que%20as%20pessoas%20se%20cadastram%2C%20portanto%2C%20%C3%A9%20melhor%20entrar%20o%20quanto%20antes).%20O%20cadastro%20%C3%A9%20gratuito%20e%20eles%20s%C3%B3%20pedem%20nome%20e%20e-mail.%20N%C3%A3o%20h%C3%A1%20o%20que%20perder%2C%20mas%2C%20se%20a%20plataforma%20se%20tornar%20o%20novo%20padr%C3%A3o%20de%20investimento%20e%20capita%C3%A7%C3%A3o%20para%20Startups%2C%20suas%20Starts%20poder%C3%A3o%20valer%20muito.%20Se%20voc%C3%AA%20deixou%20passar%20alguma%20oportunidade%20de%20comprar%20bitcoins%20h%C3%A1%20sete%20anos%2C%20n%C3%A3o%20vai%20querer%20perder%20essa%2C%20ainda%20mais%20sendo%20de%20gra%C3%A7a.%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Aqui%20est%C3%A1%20o%20meu%20link%20de%20convite%3A%20https%3A%2F%2Finitial-s.com%2Finvite%2Fsdasdasd%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Este%20link%20deixar%C3%A1%20de%20funcionar%20quando%20meus%20convites%20acabarem.%20Avise-me%20depois%20que%20voc%C3%AA%20se%20cadastrar%2C%20porque%20eu%20preciso%20aprovar%20o%20seu%20cadastro%20atrav%C3%A9s%20da%20minha%20conta.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20&amp;body=https%3A%2F%2Finitial-s.com%2Finvite%2Fsdasdasd" class="jssocials-share-link">
                                                <i class="fa fa-at jssocials-share-logo"></i>
                                            </a>
                                        </div>
                                        <div class="jssocials-share jssocials-share-twitter"><a href="#" class="jssocials-share-link"><i class="fa fa-twitter jssocials-share-logo"></i></a></div>
                                        <div class="jssocials-share jssocials-share-facebook"><a href="#" class="jssocials-share-link"><i class="fa fa-facebook jssocials-share-logo"></i></a></div>
                                       @*  <div class="jssocials-share jssocials-share-googleplus"><a href="#" class="jssocials-share-link"><i class="fa fa-google jssocials-share-logo"></i></a></div> *@
                                        <div class="jssocials-share jssocials-share-linkedin"><a href="#" class="jssocials-share-link"><i class="fa fa-linkedin jssocials-share-logo"></i></a></div>
                                        <div class="jssocials-share jssocials-share-whatsapp"><a target="_self" href="https://wa.me/?text=https%3A%2F%2Finitial-s.com%2Finvite%2Fsdasdasd%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20A%20Initial%20S%20%C3%A9%20um%20ousado%20projeto%20que%20tenta%20criar%20uma%20nova%20forma%20de%20se%20investir%20e%20de%20conseguir%20investimentos%20para%20Startups.%20Utilizando%20uma%20moeda%20propriet%C3%A1ria%2C%20a%20Start%2C%20eles%20buscam%20incentivar%20as%20pessoas%20a%20come%C3%A7arem%20a%20usar%20a%20plataforma%20uma%20vez%20que%20ela%20estiver%20pronta.%20Eles%20est%C3%A3o%20reservando%20Starts%20gratuitamente%20para%20pessoas%20que%20se%20cadastrarem%20agora%20(o%20valor%20diminui%20%C3%A0%20medida%20que%20as%20pessoas%20se%20cadastram%2C%20portanto%2C%20%C3%A9%20melhor%20entrar%20o%20quanto%20antes).%20O%20cadastro%20%C3%A9%20gratuito%20e%20eles%20s%C3%B3%20pedem%20nome%20e%20e-mail.%20N%C3%A3o%20h%C3%A1%20o%20que%20perder%2C%20mas%2C%20se%20a%20plataforma%20se%20tornar%20o%20novo%20padr%C3%A3o%20de%20investimento%20e%20capita%C3%A7%C3%A3o%20para%20Startups%2C%20suas%20Starts%20poder%C3%A3o%20valer%20muito.%20Se%20voc%C3%AA%20deixou%20passar%20alguma%20oportunidade%20de%20comprar%20bitcoins%20h%C3%A1%20sete%20anos%2C%20n%C3%A3o%20vai%20querer%20perder%20essa%2C%20ainda%20mais%20sendo%20de%20gra%C3%A7a.%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Aqui%20est%C3%A1%20o%20meu%20link%20de%20convite%3A%20https%3A%2F%2Finitial-s.com%2Finvite%2Fsdasdasd%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Este%20link%20deixar%C3%A1%20de%20funcionar%20quando%20meus%20convites%20acabarem.%20Avise-me%20depois%20que%20voc%C3%AA%20se%20cadastrar%2C%20porque%20eu%20preciso%20aprovar%20o%20seu%20cadastro%20atrav%C3%A9s%20da%20minha%20conta.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20" class="jssocials-share-link"><i class="fa fa-whatsapp jssocials-share-logo"></i></a></div>
                                    </div>
                                </div>
                            </div>


                            <div id="massage-copy" style="display:none; position:absolute; left:1000px;">
                                @Html.Raw(string.Format(htmlLocalizer["massage-copy-text"].Value, $"https://lehmonbros.fun/invite/{Model.enviarConvite.invite_code}"))
                            </div>

                        </div>
                    }
                }


                @* <div class="Dashboard-card card">
                    <div class="img-card"><b>!</b></div>
                    <h4 class="title-card">Tarefa Atual: DISCORD</h4>
                    <p class="subtitle-card">Acesse o Discord e clique no link que está no canal X:</p>
                    <div class="oneFieldForm small">
                       

                        <a href="https://discord.gg/YvHbxAZNfB?id=@Model.UserId" class="btn btn-primary">Verificar Discord</a>

                    </div>
                </div> *@

                
                @if (Model.cardSaldoAtual != null)
                {
                    if (Model.cardSaldoAtual.status)
                    {
                        <div class="Dashboard-card card">

                            <h4 class="title-card">@localizer["Saldo Atual"]</h4>
                            <div class="Balance">


                                <!-- Valor total -->
                                <div class="sum">
                                    <span class="granted">$LEMON<b>@Model.cardSaldoAtual.valorSaldo.ToString("N0")</b></span>
                                    <span class="max">@htmlLocalizer["Das suas possíveis $LEMON {0}", Model.cardSaldoAtual.valorSaldoTotal.ToString("N0")]</span>

                                </div>

                                <!-- Barra de progresso -->
                                <div class="bar-wrapper">
                                    <div class="bar">
                                        <div class="current" style="width:@Model.cardSaldoAtual.percentualAtual%"></div>
                                        <div class="granted" style="width:@Model.cardSaldoAtual.percentualReservado%"></div>
                                        <div class="adjustment"></div>
                                    </div>
                                </div>

                                <!-- Legenda -->
                                <div class="legend">
                                    <div class="granted">
                                        <i></i>
                                        <span class="label">@localizer["Reservadas"]</span>
                                    </div>
                                    <div class="current">
                                        <i></i>
                                        <span class="label">@localizer["Tarefa Atual"]</span>
                                    </div>

                                    <div class="adjustment">
                                        <i style="background-color: #f5f5f5;background-image: none;"></i>
                                        <span class="label">@localizer["Tarefas Futuras"]</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                
                }
                
            </div>


            <div class="Dashboard-column right-side">
                @if (TempData["Message"] != null)
                {
                    <div class="alert alert-success" id="success-alert">
                        @TempData["Message"]
                    </div>
                }

                @if (TempData["Error"] != null)
                {
                    <div class="alert alert-danger" id="error-alert">
                        @TempData["Error"]
                    </div>
                }

                @if (Model.cardSaldoAtual != null)
                {
                    if (Model.cardVerificaConvite.status)
                    {
                        <div class="Dashboard-card card">

                            <h4>
                                @htmlLocalizer["Você tem {0} amigos para revisar, e você já aprovou {1} num total de {2} convites disponíveis.",
                                         Model.cardVerificaConvite.ConvitesParaRevisar,
                                         Model.cardVerificaConvite.Aprovados,
                                         Model.cardVerificaConvite.ConvitesDisponiveis]
                            </h4>

                            @foreach (var item in Model.cardVerificaConvite.Usuarios)
                            {
                                string initials = "";

                                if(!String.IsNullOrEmpty(item.Nome))
                                {
                                    initials = Regex.Replace(item.Nome, @"[\p{P}\p{S}\p{C}\p{N}]+", "");
                                    initials = Regex.Replace(initials, @"\p{Z}+", " ");
                                    initials = Regex.Replace(initials.Trim(), @"\s+(?:[JS]R|I{1,3}|I[VX]|VI{0,3})$", "", RegexOptions.IgnoreCase);
                                    initials = Regex.Replace(initials, @"^(\p{L})[^\s]*(?:\s+(?:\p{L}+\s+(?=\p{L}))?(?:(\p{L})\p{L}*)?)?$", "$1$2").Trim();

                                    if (initials.Length > 2)
                                    {
                                        initials = initials.Substring(0, 2);
                                    }
                                }
                                

                                <div class="Approve-user pending">
                                    <div class="content">
                                        <div class="sb-avatar" style="display: inline-block; width: 38px; height: 38px; border-radius: 500px;">
                                            <div style="width: 38px; height: 38px; font: 12px/38px Helvetica, Arial, sans-serif; text-align: center; text-transform: uppercase; color: rgb(255, 255, 255); background: #292874; border-radius: 100%;">
                                                @initials.ToUpperInvariant()
                                            </div>
                                        </div>
                                        <header><p>@item.Nome</p></header>
                                    </div>
                                    &nbsp;&nbsp;
                                    <div>
                                        <!-- Form para Reprovar -->
                                        <form method="post" asp-page-handler="Reject" style="display: inline;">
                                            <input type="hidden" name="UserId" value="@item.Id" />
                                            <button type="submit" class="Button Button-small Button-primary" style="background-color: red !important; border: none; cursor: pointer;">
                                                <span class="label">@localizer["Reprovar"]</span>
                                            </button>
                                        </form>
                                        &nbsp;
                                        <!-- Form para Aprovar -->
                                        <form method="post" asp-page-handler="Approve" style="display: inline;">
                                            <input type="hidden" name="UserId" value="@item.Id" />
                                            <button type="submit" class="Button Button-small Button-primary" style="background-color: green !important; border: none; cursor: pointer;">
                                                <span class="label">@localizer["Aprovar"]</span>
                                            </button>
                                        </form>
                                    </div>

                                </div>
                            }

                        </div>
                    }
                }

            </div>

        </div>
        
    </section>


<script src="~/js/add-social-sharing-buttons/vendor/js/socialsharing.js"></script>


    <style>
        .alert {
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .alert.fade-out {
            opacity: 0;
        }
    </style>

    <script>

        jQuery("#btnsSocials").jsSocials({

            shares: ["email", "twitter", "facebook", "linkedin", "whatsapp"],
            url: "https://lehmonbros.fun/invite/@Model.enviarConvite.invite_code",
            text: jQuery('#massage-copy').text(),
            showLabel: false,
            showCount: false,
            shareIn: "popup",
            on: {
                click: function (e) { },
                mouseenter: function (e) { },
                mouseleave: function (e) { },

                }
        });


        // Função para ocultar o alerta após um delay
        function hideAlert(alertId, delay) {
            const alertElement = document.getElementById(alertId);
            if (alertElement) {
                console.log(`Iniciando o temporizador para o alerta com ID: ${alertId}`);
                setTimeout(() => {
                    console.log(`Ocultando o alerta com ID: ${alertId}`);
                    // Adiciona a classe 'fade-out' para iniciar a transição
                    alertElement.classList.add("fade-out");

                    // Remove o elemento do DOM após a transição
                    alertElement.addEventListener("transitionend", () => {
                        console.log(`Removendo o alerta com ID: ${alertId} do DOM`);
                        alertElement.style.display = "none";
                    });
                }, delay);
            } else {
                console.log(`Elemento com ID: ${alertId} não encontrado.`);
            }
        }

        // Quando o documento estiver pronto
        document.addEventListener("DOMContentLoaded", function () {
            console.log("DOM completamente carregado e analisado.");
            // Defina o tempo em milissegundos (por exemplo, 5 segundos)
            const delay = 1500;

            // Oculta os alertas se existirem
            hideAlert("success-alert", delay);
            hideAlert("error-alert", delay);
        });



        async function CopyToClipboard(containerid) {
    try {
        // Obter o elemento da div pelo ID
        var element = document.getElementById(containerid);
        if (!element) {
            alert("Elemento não encontrado!");
            return;
        }

        // Obter o texto da div
        var textToCopy = element.innerText || element.textContent;

        // Utilizar a Clipboard API para copiar o texto
        await navigator.clipboard.writeText(textToCopy);
        alert("Sucess!");
    } catch (err) {
        // Fallback para navegadores que não suportam a Clipboard API
        fallbackCopyTextToClipboard(containerid);
    }
}

// Função de fallback usando um textarea temporário
function fallbackCopyTextToClipboard(containerid) {
    var element = document.getElementById(containerid);
    if (!element) {
        alert("Elemento não encontrado!");
        return;
    }

    var textToCopy = element.innerText || element.textContent;

    // Criar um elemento textarea temporário
    var textarea = document.createElement('textarea');
    textarea.value = textToCopy;

    // Estilizar o textarea para não interferir na interface
    textarea.style.position = 'fixed';
    textarea.style.top = '-9999px';
    textarea.style.left = '-9999px';

    document.body.appendChild(textarea);
    textarea.focus();
    textarea.select();

    try {
        var successful = document.execCommand('copy');
        if (successful) {
            alert("O texto foi copiado com sucesso!");
        } else {
            alert("Falha ao copiar o texto.");
        }
    } catch (err) {
        alert("Erro ao copiar o texto: " + err);
    }

    // Remover o textarea temporário
    document.body.removeChild(textarea);
}




    </script>
</article>
